---
phase: 03-sellercloud-integration-demand-visibility
plan: 04
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/app/(dashboard)/executive/page.tsx
  - src/components/dashboard/app-sidebar.tsx
  - src/app/(dashboard)/page.tsx
  - src/app/(dashboard)/sync/page.tsx
autonomous: true

must_haves:
  truths:
    - "Executive summary page shows one-screen health check with top alerts, key numbers, and action items"
    - "Navigation includes Demand section with links to demand summary, retailer view, SKU view, and executive summary"
    - "Sync management page allows triggering manual SellerCloud sync and viewing sync status"
    - "Dashboard page shows demand health indicators alongside existing stat cards"
  artifacts:
    - path: "src/app/(dashboard)/executive/page.tsx"
      provides: "One-screen executive health dashboard"
      min_lines: 80
    - path: "src/components/dashboard/app-sidebar.tsx"
      provides: "Updated sidebar with Demand and Sync sections"
      contains: "Demand"
    - path: "src/app/(dashboard)/sync/page.tsx"
      provides: "Manual sync trigger and sync history page"
      min_lines: 40
  key_links:
    - from: "src/app/(dashboard)/executive/page.tsx"
      to: "alerts.summary|demand.monthlySummary"
      via: "trpc queries"
      pattern: "trpc\\.alerts\\.summary|trpc\\.demand\\.monthlySummary"
    - from: "src/app/(dashboard)/sync/page.tsx"
      to: "sellercloud.syncPurchaseOrders|sellercloud.syncStatus"
      via: "trpc mutations and queries"
      pattern: "trpc\\.sellercloud"
    - from: "src/components/dashboard/app-sidebar.tsx"
      to: "demand pages"
      via: "navigation links"
      pattern: "/demand|/executive|/sync"
---

<objective>
Build the executive summary dashboard, sync management page, update sidebar navigation to include Demand section, and enhance the main dashboard with demand health indicators.

Purpose: Provides the executive health check view (UX-03), organizes navigation by function (UX-05), and gives users control over SellerCloud sync status. Completes the user experience for Phase 3.
Output: Executive summary page, sync page, updated sidebar navigation, enhanced dashboard.
</objective>

<execution_context>
@/Users/kaaba/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kaaba/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-sellercloud-integration-demand-visibility/03-RESEARCH.md
@.planning/phases/03-sellercloud-integration-demand-visibility/03-02-SUMMARY.md
@src/components/dashboard/app-sidebar.tsx
@src/app/(dashboard)/page.tsx
@src/components/dashboard/stat-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Executive summary page and sync management page</name>
  <files>
    src/app/(dashboard)/executive/page.tsx
    src/app/(dashboard)/sync/page.tsx
  </files>
  <action>
Create `src/app/(dashboard)/executive/page.tsx` (Executive Summary - one screen health check):
- "use client" page
- Queries:
  - `trpc.alerts.summary.useQuery({})` — total shortage/excess SKUs, top alerts, total units
  - `trpc.demand.monthlySummary.useQuery({})` — monthly trend data
  - `trpc.brands.count.useQuery()`, `trpc.skus.count.useQuery()` — key numbers
  - `trpc.orders.purchaseOrders.count.useQuery()`, `trpc.orders.retailOrders.count.useQuery()`
- Layout (single screen, no scrolling needed for key info):
  - Header: "Executive Summary" + current date
  - Row 1 — Key Numbers (4 stat cards in a grid):
    - Total Brands, Total SKUs, Active POs, Active Retail Orders
  - Row 2 — Alert Summary (2 cards, side by side):
    - Left card: "Shortage Alerts" — big number of SKUs with shortages, total shortage units, top 3 SKU names listed
    - Right card: "Excess Alerts" — big number of SKUs with excess, total excess units, top 3 SKU names listed
    - Cards use red background/border for shortages, amber for excess
    - If zero alerts: green card with "All Clear" message
  - Row 3 — Monthly Trend (simple table or mini-cards):
    - Show current month + next 3 months: Forecasted total, Ordered total, Available total per month
    - Color-code each month: green if balance positive, red if negative
  - Row 4 — Action Items:
    - Auto-generated action items based on data:
      - If shortage > 0: "Review {N} SKUs with inventory shortages" with link to /demand/by-sku
      - If excess > 0: "Review {N} SKUs with excess inventory" with link to /demand/by-sku
      - If no recent sync: "Sync SellerCloud data for latest inventory" with link to /sync
      - If no forecasts: "Import forecast data" with link to /import
    - Each action item: text + link, displayed as a clean list with icons

Use existing StatCard component for key numbers. Use shadcn Card for alert summary cards. Keep it visually clean — this is CEO-facing.

Create `src/app/(dashboard)/sync/page.tsx` (Sync Management):
- "use client" page
- Queries: `trpc.sellercloud.syncStatus.useQuery()`
- Mutations: `trpc.sellercloud.syncPurchaseOrders.useMutation()`, `trpc.sellercloud.syncInventory.useMutation()`
- Layout:
  - Header: "SellerCloud Sync"
  - Two action cards side by side:
    - "Sync Purchase Orders" card: Button to trigger syncPurchaseOrders, shows last sync time from syncStatus data
    - "Sync Inventory" card: Button to trigger syncInventory, shows last sync time
  - Buttons show loading spinner (use sonner toast for success/error feedback after mutation)
  - Sync History table below: last 10 sync log entries showing entityType, status, recordsProcessed/Created/Updated, duration, triggeredBy, timestamp
  - Status badges: "running" = blue, "completed" = green, "failed" = red
  - If SellerCloud not configured (mutation returns error message): show info alert explaining user needs to set env vars
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify both page files exist at the correct paths. Check that executive page uses alerts.summary and demand.monthlySummary queries. Check that sync page uses sellercloud router procedures.
  </verify>
  <done>
Executive summary page provides one-screen health check with key numbers, alert summary, monthly trends, and auto-generated action items. Sync page allows triggering manual sync and viewing sync history. Both pages compile and render.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update sidebar navigation and main dashboard</name>
  <files>
    src/components/dashboard/app-sidebar.tsx
    src/app/(dashboard)/page.tsx
  </files>
  <action>
Update `src/components/dashboard/app-sidebar.tsx`:

Replace the `navSections` array with an expanded version that adds Demand section. Keep all existing sections intact. Add new icons from lucide-react: `BarChart3`, `Target`, `AlertTriangle`, `Activity`, `RefreshCw`.

New nav structure:
```
Overview:
  - Dashboard (/)              [LayoutDashboard] (existing)
  - Executive Summary (/executive) [Activity] (NEW)

Demand:                         (NEW section)
  - Demand Summary (/demand)   [BarChart3]
  - By Retailer (/demand/by-retailer) [Target]
  - By SKU (/demand/by-sku)    [Box]

Data:                           (existing)
  - Import (/import)           [Upload]
  - Forecasts (/forecasts)     [TrendingUp]

Orders:                         (existing)
  - Purchase Orders (/orders/purchase-orders) [ShoppingCart]
  - Retail Orders (/orders/retail-orders) [ShoppingBag]

Master Data:                    (existing)
  - Brands (/brands)           [Package]
  - SKUs (/skus)               [Box]
  - Retailers (/retailers)     [Store]

System:                         (existing, expanded)
  - SellerCloud Sync (/sync)   [RefreshCw] (NEW)
  - Audit Log (/audit)         [FileText] (existing)
```

Update the isActive check to handle nested routes: for paths like "/demand/by-retailer", use `pathname.startsWith(item.href)` but only for href !== "/" to avoid matching everything. For "/" use exact match.

Update `src/app/(dashboard)/page.tsx`:
- Keep all existing stat cards (brands, skus, retailers, purchase orders, retail orders, forecasts)
- Add a new section below the existing stats: "Demand Health" header
- Add a row of 3 new stat cards:
  - "Shortage SKUs" — uses `trpc.alerts.summary.useQuery({})`, shows `totalShortageSkus`, icon AlertTriangle, red accent if > 0
  - "Excess SKUs" — shows `totalExcessSkus`, icon TrendingUp, amber accent if > 0
  - "Total Forecasted" — uses a new count or summary query showing total forecasted units for current month
- Keep the dashboard clean and fast-loading. Handle loading states with the existing StatCard loading prop.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify sidebar has the Demand section with 3 items and the System section includes SellerCloud Sync. Run `npm run build` to verify all pages compile. Verify main dashboard still loads with new demand health section.
  </verify>
  <done>
Sidebar navigation includes new Demand section (Demand Summary, By Retailer, By SKU), Executive Summary in Overview, and SellerCloud Sync in System. Main dashboard shows demand health indicators (shortage SKUs, excess SKUs) alongside existing stat cards. Navigation organized by function (UX-05). Active route highlighting works for nested routes.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Sidebar shows 6 navigation sections (Overview, Demand, Data, Orders, Master Data, System)
4. Executive summary page loads at /executive with key numbers, alerts, trends, and action items
5. Sync page loads at /sync with sync trigger buttons and history table
6. Main dashboard (/) shows demand health indicators
7. All navigation links work and highlight correctly
</verification>

<success_criteria>
- Executive summary provides one-screen health check (UX-03)
- Navigation organized by brand and function with Demand section (UX-05)
- Sync management page allows manual SellerCloud data refresh
- Dashboard enhanced with demand health indicators
- Non-technical team can navigate intuitively between views
</success_criteria>

<output>
After completion, create `.planning/phases/03-sellercloud-integration-demand-visibility/03-04-SUMMARY.md`
</output>
