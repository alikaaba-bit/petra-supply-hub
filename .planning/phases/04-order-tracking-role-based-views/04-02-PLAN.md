---
phase: 04-order-tracking-role-based-views
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/(dashboard)/tracking/supplier-orders/page.tsx
  - src/app/(dashboard)/tracking/supplier-orders/[id]/page.tsx
  - src/app/(dashboard)/tracking/supplier-orders/columns.tsx
  - src/app/(dashboard)/tracking/retail-orders/page.tsx
  - src/app/(dashboard)/tracking/retail-orders/[id]/page.tsx
  - src/app/(dashboard)/tracking/retail-orders/columns.tsx
autonomous: true

must_haves:
  truths:
    - "Supplier PO tracking page shows list of all supplier POs with deposit status, production status, and shipping status"
    - "Clicking a supplier PO shows detail view with full timeline visualization and line items"
    - "Retail PO tracking page shows incoming POs from retailers with fulfillment status"
    - "Clicking a retail order shows detail view with line items and fulfillment progress"
    - "Lead time visibility shows order-by dates and expected arrival dates on supplier PO list"
    - "Both pages support filtering by brand and status"
  artifacts:
    - path: "src/app/(dashboard)/tracking/supplier-orders/page.tsx"
      provides: "Supplier PO tracking list page"
      min_lines: 40
    - path: "src/app/(dashboard)/tracking/supplier-orders/[id]/page.tsx"
      provides: "Supplier PO detail page with timeline"
      min_lines: 50
    - path: "src/app/(dashboard)/tracking/supplier-orders/columns.tsx"
      provides: "Table column definitions for supplier PO list"
      exports: ["columns"]
    - path: "src/app/(dashboard)/tracking/retail-orders/page.tsx"
      provides: "Retail order tracking list page"
      min_lines: 40
    - path: "src/app/(dashboard)/tracking/retail-orders/[id]/page.tsx"
      provides: "Retail order detail page"
      min_lines: 50
    - path: "src/app/(dashboard)/tracking/retail-orders/columns.tsx"
      provides: "Table column definitions for retail order list"
      exports: ["columns"]
  key_links:
    - from: "src/app/(dashboard)/tracking/supplier-orders/page.tsx"
      to: "src/server/api/routers/tracking.ts"
      via: "tRPC query tracking.supplierOrders"
      pattern: "tracking\\.supplierOrders"
    - from: "src/app/(dashboard)/tracking/supplier-orders/[id]/page.tsx"
      to: "src/components/tracking/po-timeline.tsx"
      via: "POTimeline component rendering"
      pattern: "POTimeline"
    - from: "src/app/(dashboard)/tracking/retail-orders/page.tsx"
      to: "src/server/api/routers/tracking.ts"
      via: "tRPC query tracking.retailOrders"
      pattern: "tracking\\.retailOrders"
    - from: "src/app/(dashboard)/tracking/supplier-orders/page.tsx"
      to: "src/components/tracking/lead-time-badge.tsx"
      via: "LeadTimeBadge in supplier order list or detail"
      pattern: "LeadTimeBadge"
---

<objective>
Build supplier PO tracking and retail order tracking pages with timeline visualization and lead time visibility.

Purpose: Satisfies ORD-01 (supplier PO tracking), ORD-02 (retail PO tracking), ORD-03 (lead time visibility), and ORD-04 (PO lifecycle timeline). These are the core order tracking views that give purchasing and warehouse teams visibility into the order pipeline.

Output: 6 files — supplier order list + detail + columns, retail order list + detail + columns, all under /tracking/ routes.
</objective>

<execution_context>
@/Users/kaaba/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kaaba/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-order-tracking-role-based-views/04-RESEARCH.md
@.planning/phases/04-order-tracking-role-based-views/04-01-SUMMARY.md

@src/server/api/routers/tracking.ts
@src/components/tracking/status-badge.tsx
@src/components/tracking/lead-time-badge.tsx
@src/components/tracking/po-timeline.tsx
@src/components/tracking/order-status-card.tsx
@src/lib/lead-time.ts
@src/app/(dashboard)/orders/purchase-orders/page.tsx
@src/app/(dashboard)/orders/purchase-orders/columns.tsx
@src/components/dashboard/data-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Supplier PO tracking list and detail pages</name>
  <files>
    src/app/(dashboard)/tracking/supplier-orders/page.tsx
    src/app/(dashboard)/tracking/supplier-orders/[id]/page.tsx
    src/app/(dashboard)/tracking/supplier-orders/columns.tsx
  </files>
  <action>
    Create the supplier PO tracking pages under `src/app/(dashboard)/tracking/supplier-orders/`.

    **columns.tsx** — "use client". Define @tanstack/react-table column definitions for supplier PO tracking. Columns: PO Number (link to detail page), Brand Name, Supplier, Status (StatusBadge), Order Date (formatted with date-fns), Expected Arrival (formatted), Deposit Status (green check or red X icon based on depositPaid boolean), Lead Time (LeadTimeBadge showing order-by urgency based on expectedArrival and brand.leadTimeDays — compute orderByDate inline using calculateOrderByDate from lib/lead-time.ts). Follow the pattern in existing orders/purchase-orders/columns.tsx.

    **page.tsx** — "use client". Title: "Supplier PO Tracking". Shows OrderStatusCard at top with PO counts by status from tracking.statusSummary. Below that, brand filter dropdown (use existing BrandSelector pattern or simple Select from shadcn) and status filter dropdown. Data table using DataTable component with columns from columns.tsx, data from tracking.supplierOrders query. Use @tanstack/react-query via tRPC (api.tracking.supplierOrders.useQuery). Follow the pattern of existing orders/purchase-orders/page.tsx for structure.

    **[id]/page.tsx** — "use client". Fetches single PO via tracking.supplierOrderDetail({ id }). Layout: top section shows PO header (PO number, supplier, brand, dates, amounts) in a Card grid (2 columns on lg). Below that: POTimeline component showing current lifecycle state. Below timeline: line items table (SKU, quantity, unit cost, total) and payments table (type, amount, status, dates). Handle loading state with skeletons. Handle not-found with redirect or error message. Show LeadTimeBadge with computed order-by date. Include "Back to Supplier Orders" link.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify compilation. Verify the page renders by checking that the route files exist at the correct paths.
  </verify>
  <done>
    Supplier PO tracking list page shows all POs with status badges, deposit status, and lead time urgency. Detail page shows full PO info with POTimeline visualization, line items, and payments. Brand and status filters work on list page.
  </done>
</task>

<task type="auto">
  <name>Task 2: Retail order tracking list and detail pages</name>
  <files>
    src/app/(dashboard)/tracking/retail-orders/page.tsx
    src/app/(dashboard)/tracking/retail-orders/[id]/page.tsx
    src/app/(dashboard)/tracking/retail-orders/columns.tsx
  </files>
  <action>
    Create the retail order tracking pages under `src/app/(dashboard)/tracking/retail-orders/`.

    **columns.tsx** — "use client". Column definitions for retail order tracking. Columns: Retailer PO Number (link to detail), Retailer Name, Brand Name, Status (StatusBadge — using retail statuses: received, processing, allocated, shipped, delivered), Order Date (formatted), Ship By Date (formatted with urgency color if approaching — use amber text if within 7 days), Total Amount. Follow existing retail-orders/columns.tsx pattern.

    **page.tsx** — "use client". Title: "Retail Order Tracking". Shows OrderStatusCard at top with retail order counts by status (from tracking.statusSummary, use the retail order portion). Brand filter, retailer filter (Select with retailer list from retailers.list query), and status filter. DataTable with columns and data from tracking.retailOrders query. Follow existing orders/retail-orders/page.tsx structure.

    **[id]/page.tsx** — "use client". Fetches single retail order via tracking.retailOrderDetail({ id }). Layout: header Card with retailer name, PO number, brand, status badge, dates, total amount. Below: line items table (SKU, quantity, unit price, total). Payments section if any. Fulfillment status shown prominently with StatusBadge. "Back to Retail Orders" link. Handle loading/not-found states.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify compilation. Verify the route files exist at correct paths.
  </verify>
  <done>
    Retail order tracking list page shows all retail orders with fulfillment status, ship-by dates, and filtering. Detail page shows full order info with line items and payment status. Retailer and brand filters work on list page.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. /tracking/supplier-orders route renders PO list with StatusBadge and LeadTimeBadge
3. /tracking/supplier-orders/[id] renders POTimeline + line items + payments
4. /tracking/retail-orders route renders retail order list with fulfillment StatusBadge
5. /tracking/retail-orders/[id] renders order detail with line items
6. Both list pages support brand and status filtering
</verification>

<success_criteria>
- Supplier PO tracking displays internal POs to China with deposit status, production status, and shipping status (ORD-01)
- Retail PO tracking shows incoming POs from retailers with fulfillment status (ORD-02)
- Lead time visibility displays order-by dates and expected arrival dates per SKU (ORD-03)
- PO lifecycle timeline visualizes the pipeline: ordered -> in production -> shipped -> in transit -> arrived (ORD-04)
- All pages compile and render without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-order-tracking-role-based-views/04-02-SUMMARY.md`
</output>
