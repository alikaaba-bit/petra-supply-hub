# Milestone v1.0: Petra Supply Hub MVP

**Status:** SHIPPED 2026-02-07
**Phases:** 1-4
**Total Plans:** 13

## Overview

This roadmap transforms Petra Brands from scattered Excel spreadsheets to a unified supply chain dashboard across 5 brands, 160 SKUs, and 12 retailers. The journey moves from establishing technical foundation and master data structures, through enabling data integration and demand visibility, to delivering complete order tracking with role-based views. Each phase builds on the previous, delivering incremental value while maintaining Excel compatibility during transition.

**Note:** Cash flow visibility features (CFW-01 through CFW-04) have been deferred to v2. v1.0 covers 4 phases: demand visibility and order tracking.

## Phases

### Phase 1: Foundation & Master Data

**Goal**: Establish technical foundation with database schema, authentication system, and canonical master data for all brands, SKUs, and retailers

**Depends on**: Nothing (first phase)

**Requirements**: FND-01, FND-02, FND-03, FND-04, UX-04

**Success Criteria** (what must be TRUE):
  1. Database schema exists supporting 5 brands, 160 SKUs, 12 retailers, with tables for forecasts, POs, inventory, and payments
  2. Users can log in with assigned roles (CEO, sales, purchasing, warehouse) and access the dashboard
  3. Master data tables contain canonical reference data for all 5 brands and ~16 retailers with real names/codes, plus ~158 representative placeholder SKUs
  4. Audit log captures who changed what data and when, visible to authorized users
  5. Dashboard UI displays clean, visual design that non-technical team members can navigate without training

**Plans**: 3 plans in 3 waves (sequential)

Plans:
- [x] 01-01-PLAN.md — Project scaffolding, database schema (16 tables), and connection pooling
- [x] 01-02-PLAN.md — Auth.js authentication, tRPC API layer, master data routers, and audit triggers
- [x] 01-03-PLAN.md — Dashboard UI with sidebar, master data CRUD pages, seed data, and audit viewer

### Phase 2: Data Integration & Manual Entry

**Goal**: Enable team to input forecast and sales data through Excel uploads and manual entry, with validation to prevent bad data

**Depends on**: Phase 1

**Requirements**: DAT-01, DAT-03, DAT-04, DAT-05

**Success Criteria** (what must be TRUE):
  1. Team can upload Excel files in RTL FORECAST_MASTER format and HOP product-centric format, seeing parsed data before committing
  2. Team can manually create and update orders when Excel data is incomplete or SellerCloud data is unavailable
  3. Team can upload retail sales Excel files for SKU performance tracking across retailers
  4. Data validation flags errors during import, shows preview, and rejects malformed data
  5. Imported data appears immediately in dashboard views after validation passes

**Plans**: 3 plans in 2 waves

Plans:
- [x] 02-01-PLAN.md — Dependencies, ExcelJS parsers (RTL/HOP/retail sales), Zod validators, import service, Server Actions, tRPC routers, retailSales table
- [x] 02-02-PLAN.md — Import wizard UI (dropzone, format detection, validation results, preview table, commit)
- [x] 02-03-PLAN.md — Purchase order & retail order CRUD pages, forecasts list, sidebar reorganization, dashboard stats

### Phase 3: SellerCloud Integration & Demand Visibility

**Goal**: Automatically pull POs and inventory from SellerCloud, display demand vs supply gaps across all brands, and provide executive summary dashboard

**Depends on**: Phase 2

**Requirements**: DAT-02, DEM-01, DEM-02, DEM-03, DEM-04, DEM-05, UX-01, UX-03, UX-05

**Success Criteria** (what must be TRUE):
  1. Dashboard automatically pulls POs, inventory levels, shipment tracking, and payment status from SellerCloud via API
  2. Cross-brand demand summary shows forecasted units vs ordered units vs in-stock units per brand per month
  3. Retailer-level breakdown displays what each retailer needs across all brands
  4. SKU-level drill-down shows demand, ordered, available, in-transit, and balance for every SKU
  5. Shortage alerts automatically flag SKUs where forecasted demand exceeds ordered + available inventory
  6. Excess alerts automatically flag SKUs where ordered/available significantly exceeds forecasted demand
  7. Brand selector allows users to view all brands or filter to a single brand
  8. Executive summary page provides one-screen health check with top alerts, key numbers, and action items
  9. Navigation organizes views by brand and by function

**Plans**: 4 plans in 3 waves

Plans:
- [x] 03-01-PLAN.md — SellerCloud API client with retry/backoff, sync tracking schema, sync tRPC router
- [x] 03-02-PLAN.md — Demand aggregation tRPC router (cross-brand, retailer, SKU) and alerts calculation router
- [x] 03-03-PLAN.md — Demand dashboard pages (cross-brand summary, retailer breakdown, SKU drill-down) with brand selector
- [x] 03-04-PLAN.md — Executive summary page, sync management page, sidebar navigation update

### Phase 4: Order Tracking & Role-Based Views

**Goal**: Track complete PO lifecycle from China suppliers and retail customers, with role-specific dashboard views for each team member type

**Depends on**: Phase 3

**Requirements**: ORD-01, ORD-02, ORD-03, ORD-04, UX-02

**Success Criteria** (what must be TRUE):
  1. Supplier PO tracking displays internal POs to China with deposit status, production status, and shipping status
  2. Retail PO tracking shows incoming POs from retailers with fulfillment status
  3. Lead time visibility displays order-by dates and expected arrival dates per SKU
  4. PO lifecycle timeline visualizes the pipeline: ordered > in production > shipped > in transit > arrived > allocated
  5. Role-based views show appropriate information for each user type

**Plans**: 3 plans in 2 waves

Plans:
- [x] 04-01-PLAN.md — Tracking tRPC router, shared UI components, lead time utilities
- [x] 04-02-PLAN.md — Supplier PO tracking pages (list + detail with timeline) and retail order tracking pages
- [x] 04-03-PLAN.md — Role-based dashboards (CEO, Sales, Purchasing, Warehouse) and sidebar navigation update

---

## Milestone Summary

**Key Decisions:**
- Web app over Google Sheets: Need role-based views, SellerCloud integration, and clean UX
- Start with Excel import, add API later: SellerCloud API access not yet available
- Cash flow visibility deferred to v2: Focus on demand and order tracking first
- Drizzle ORM over Prisma: Lighter serverless footprint
- JWT strategy for Auth.js: Required for Credentials provider
- PostgreSQL-level aggregation: SQL templates instead of client-side reduce
- 5-day buffer for order-by calculations: Accounts for processing time

**Issues Resolved:**
- DrizzleAdapter type conflict with JWT strategy (removed adapter)
- Next.js Suspense requirement for useSearchParams
- PostgreSQL SUM returns strings (explicit Number() conversion)
- Zod schema inference issues with .optional() and .default()

**Issues Deferred:**
- SellerCloud API credentials: Integration layer complete, awaiting credentials for testing
- Vendor-to-brand mapping: Defaults to brandId 1 until mapping table implemented
- Automated sync scheduler: Manual sync only, cron deferred to v2
- HOP Excel format: Parser tentative, may need adjustment with real files

**Technical Debt Incurred:**
- SellerCloud vendor-brand mapping defaults to brandId 1
- HOP parser may need adjustment with real files
- No automated sync scheduling (manual only)
- Role-based auth uses simple string comparison (no RBAC framework)

---

_For current project status, see .planning/ROADMAP.md_
